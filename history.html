<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>历史数据 - 直播数据</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f5f5f5;
      padding: 20px;
    }
    .nav {
      margin-bottom: 20px;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .nav a {
      color: #333;
      text-decoration: none;
      margin-right: 20px;
      font-weight: bold;
    }
    .nav a.active {
      color: #1890ff;
    }
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .card h2 {
      margin-bottom: 15px;
      color: #1890ff;
      font-size: 1.2em;
    }
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .filter-item {
      display: flex;
      flex-direction: column;
    }
    .filter-item label {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 5px;
    }
    .filter-item input,
    .filter-item select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.95em;
    }
    .filter-item button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.95em;
    }
    .filter-item button:hover {
      background: #40a9ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #f8f9fa;
      font-weight: bold;
      color: #666;
    }
    tr:hover {
      background: #f8f9fa;
    }
    .empty-message {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="nav">
    <a href="/Live-data/">实时数据</a>
    <a href="/Live-data/history.html" class="active">历史数据</a>
  </div>

  <div class="card">
    <h2>历史数据查询</h2>
    <div class="filters">
      <div class="filter-item">
        <label>开始日期</label>
        <input type="date" id="start-date">
      </div>
      <div class="filter-item">
        <label>结束日期</label>
        <input type="date" id="end-date">
      </div>
      <div class="filter-item">
        <label>数据类型</label>
        <select id="data-type">
          <option value="all">全部数据</option>
          <option value="viewers">观看数据</option>
          <option value="engagement">互动数据</option>
          <option value="sales">销售数据</option>
        </select>
      </div>
      <div class="filter-item">
        <label>&nbsp;</label>
        <button onclick="queryData()">查询</button>
      </div>
    </div>

    <div id="result">
      <table>
        <thead>
          <tr>
            <th>日期</th>
            <th>观看人数</th>
            <th>观看人次</th>
            <th>最高在线</th>
            <th>平均在线</th>
            <th>评论数</th>
            <th>新增粉丝</th>
            <th>成交金额</th>
            <th>成交件数</th>
            <th>成交人数</th>
          </tr>
        </thead>
        <tbody id="data-table">
          <!-- 数据将通过JavaScript动态填充 -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // 设置默认日期范围（最近7天）
    function setDefaultDates() {
      const end = new Date();
      const start = new Date();
      start.setDate(start.getDate() - 6);
      
      document.getElementById('start-date').value = formatDate(start);
      document.getElementById('end-date').value = formatDate(end);
    }

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function formatNumber(num) {
      return new Intl.NumberFormat('zh-CN').format(num);
    }

    async function queryData() {
      try {
        const response = await fetch('/Live-data/data/live-data.json');
        if (!response.ok) throw new Error('Failed to fetch data');
        const data = await response.json();
        
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        const dataType = document.getElementById('data-type').value;

        // 过滤并显示数据
        displayFilteredData(data, startDate, endDate, dataType);
      } catch (error) {
        console.error('Error fetching data:', error);
        document.getElementById('data-table').innerHTML = `
          <tr>
            <td colspan="10" class="empty-message">获取数据失败，请稍后重试</td>
          </tr>
        `;
      }
    }

    function displayFilteredData(data, startDate, endDate, dataType) {
      const tableBody = document.getElementById('data-table');
      const rows = [];

      // 获取所有日期的数据
      const dailyData = {};
      if (data.logs) {
        data.logs.forEach(log => {
          if (!dailyData[log.date]) {
            dailyData[log.date] = {
              date: log.date,
              '直播间观看人数': 0,
              '直播间观看人次': 0,
              '最高在线人数': 0,
              '平均在线人数': 0,
              '评论次数': 0,
              '新增粉丝数': 0,
              '直播间成交金额': 0,
              '直播间成交件数': 0,
              '直播间成交人数': 0
            };
          }
        });
      }

      // 过滤日期范围内的数据
      Object.entries(dailyData)
        .filter(([date]) => date >= startDate && date <= endDate)
        .sort(([dateA], [dateB]) => dateB.localeCompare(dateA))
        .forEach(([date, stats]) => {
          const row = `
            <tr>
              <td>${date}</td>
              <td>${formatNumber(stats['直播间观看人数'])}</td>
              <td>${formatNumber(stats['直播间观看人次'])}</td>
              <td>${formatNumber(stats['最高在线人数'])}</td>
              <td>${formatNumber(stats['平均在线人数'])}</td>
              <td>${formatNumber(stats['评论次数'])}</td>
              <td>${formatNumber(stats['新增粉丝数'])}</td>
              <td>${formatNumber(stats['直播间成交金额'])}</td>
              <td>${formatNumber(stats['直播间成交件数'])}</td>
              <td>${formatNumber(stats['直播间成交人数'])}</td>
            </tr>
          `;
          rows.push(row);
        });

      if (rows.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="10" class="empty-message">没有找到符合条件的数据</td>
          </tr>
        `;
      } else {
        tableBody.innerHTML = rows.join('');
      }
    }

    // 页面加载时设置默认日期并查询数据
    setDefaultDates();
    queryData();

    // 每分钟刷新一次数据
    setInterval(queryData, 60000);
  </script>
</body>
</html> 